{% extends 'billingapp/base.html' %}
{% load static %}

{% block title %}Invoices - PixelCrafte Billing{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">
    <!-- Page Header -->
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Invoices</h1>
            <p class="text-gray-600 mt-1">Manage and track all your invoices and payments</p>
        </div>
        <div class="flex gap-3">
            <button onclick="exportInvoices()" class="btn btn-outline btn-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Export
            </button>
            <a href="{% url 'billingapp:invoice' %}" class="btn bg-main text-white hover:bg-main/90 btn-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                New Invoice
            </a>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="card bg-white shadow-lg border border-gray-100">
            <div class="card-body p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Invoices</p>
                        <p class="text-2xl font-bold text-gray-900" id="total-invoices">{{ total_invoices|default:'0' }}</p>
                    </div>
                    <div class="w-12 h-12 bg-main/10 rounded-lg flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-main" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                </div>
                <div class="mt-2">
                    <span class="text-sm text-gray-500">All time</span>
                </div>
            </div>
        </div>

        <div class="card bg-white shadow-lg border border-gray-100">
            <div class="card-body p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Value</p>
                        <p class="text-2xl font-bold text-gray-900" id="total-value">${{ total_value|default:'0.00' }}</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                        </svg>
                    </div>
                </div>
                <div class="mt-2">
                    <span class="text-sm text-gray-500">All invoices</span>
                </div>
            </div>
        </div>

        <div class="card bg-white shadow-lg border border-gray-100">
            <div class="card-body p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Paid Amount</p>
                        <p class="text-2xl font-bold text-green-600" id="paid-amount">${{ paid_amount|default:'0.00' }}</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </div>
                <div class="mt-2">
                    <span class="text-sm text-gray-500">Payment rate: {{ payment_rate|default:'0' }}%</span>
                </div>
            </div>
        </div>

        <div class="card bg-white shadow-lg border border-gray-100">
            <div class="card-body p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Outstanding</p>
                        <p class="text-2xl font-bold text-red-600" id="outstanding-amount">${{ outstanding_amount|default:'0.00' }}</p>
                    </div>
                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </div>
                <div class="mt-2">
                    <span class="text-sm text-gray-500">{{ overdue_count|default:'0' }} overdue</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="card bg-white shadow-lg border border-gray-100">
        <div class="card-body p-6">
            <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                <!-- Search Input -->
                <div class="flex-1">
                    <div class="form-control">
                        <div class="input-group">
                            <input type="text" 
                                   id="searchInput"
                                   placeholder="Search by invoice number, client name, or description..." 
                                   class="input input-bordered w-full focus:border-main focus:ring-2 focus:ring-main/20">
                            <button class="btn btn-square" onclick="performSearch()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Payment Status Filter -->
                <div class="form-control">
                    <select id="paymentStatusFilter" class="select select-bordered focus:border-main focus:ring-2 focus:ring-main/20" onchange="applyFilters()">
                        <option value="">All Payments</option>
                        <option value="paid">Paid</option>
                        <option value="partial">Partially Paid</option>
                        <option value="unpaid">Unpaid</option>
                        <option value="overdue">Overdue</option>
                    </select>
                </div>

                <!-- Status Filter -->
                <div class="form-control">
                    <select id="statusFilter" class="select select-bordered focus:border-main focus:ring-2 focus:ring-main/20" onchange="applyFilters()">
                        <option value="">All Status</option>
                        <option value="draft">Draft</option>
                        <option value="sent">Sent</option>
                        <option value="viewed">Viewed</option>
                        <option value="paid">Paid</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>

                <!-- Date Filter -->
                <div class="form-control">
                    <select id="dateFilter" class="select select-bordered focus:border-main focus:ring-2 focus:ring-main/20" onchange="applyFilters()">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                    </select>
                </div>

                <!-- Amount Filter -->
                <div class="form-control">
                    <select id="amountFilter" class="select select-bordered focus:border-main focus:ring-2 focus:ring-main/20" onchange="applyFilters()">
                        <option value="">All Amounts</option>
                        <option value="0-1000">$0 - $1,000</option>
                        <option value="1000-5000">$1,000 - $5,000</option>
                        <option value="5000-10000">$5,000 - $10,000</option>
                        <option value="10000+">$10,000+</option>
                    </select>
                </div>

                <!-- Clear Filters -->
                <button onclick="clearFilters()" class="btn btn-outline btn-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Clear
                </button>
            </div>
        </div>
    </div>

    <!-- Invoices Table -->
    <div class="card bg-white shadow-lg border border-gray-100">
        <div class="card-body p-0">
            <!-- Table Header -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-800">Recent Invoices</h3>
                    <div class="flex items-center gap-2">
                        <span class="text-sm text-gray-600">Show:</span>
                        <select id="entriesPerPage" class="select select-bordered select-sm" onchange="changeEntriesPerPage()">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <span class="text-sm text-gray-600">entries</span>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="overflow-x-auto">
                <table class="table w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="text-left p-4">
                                <button class="flex items-center gap-1 font-semibold text-gray-700 hover:text-main" onclick="sortTable('invoice_number')">
                                    Invoice #
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                    </svg>
                                </button>
                            </th>
                            <th class="text-left p-4">
                                <button class="flex items-center gap-1 font-semibold text-gray-700 hover:text-main" onclick="sortTable('client')">
                                    Client
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                    </svg>
                                </button>
                            </th>
                            <th class="text-left p-4">
                                <button class="flex items-center gap-1 font-semibold text-gray-700 hover:text-main" onclick="sortTable('issue_date')">
                                    Issue Date
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                    </svg>
                                </button>
                            </th>
                            <th class="text-left p-4">
                                <button class="flex items-center gap-1 font-semibold text-gray-700 hover:text-main" onclick="sortTable('due_date')">
                                    Due Date
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                    </svg>
                                </button>
                            </th>
                            <th class="text-right p-4">
                                <button class="flex items-center gap-1 font-semibold text-gray-700 hover:text-main ml-auto" onclick="sortTable('amount')">
                                    Amount
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                    </svg>
                                </button>
                            </th>
                            <th class="text-center p-4">Payment Status</th>
                            <th class="text-center p-4">Status</th>
                            <th class="text-center p-4">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="invoicesTableBody">
                        <!-- Sample Data - Replace with Django template data -->
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="p-4">
                                <div class="font-medium text-gray-900">INV-2025-09-001</div>
                                <div class="text-sm text-gray-500">Created today</div>
                            </td>
                            <td class="p-4">
                                <div class="font-medium text-gray-900">Acme Corporation</div>
                                <div class="text-sm text-gray-500">john@acme.com</div>
                            </td>
                            <td class="p-4">
                                <div class="text-gray-900">Sep 14, 2025</div>
                                <div class="text-sm text-gray-500">Today</div>
                            </td>
                            <td class="p-4">
                                <div class="text-gray-900">Oct 14, 2025</div>
                                <div class="text-sm text-orange-600">30 days</div>
                            </td>
                            <td class="p-4 text-right">
                                <div class="font-medium text-gray-900">$2,850.00</div>
                                <div class="text-sm text-gray-500">USD</div>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge badge-success badge-sm">Paid</span>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge badge-info badge-sm">Sent</span>
                            </td>
                            <td class="p-4">
                                <div class="flex items-center justify-center gap-2">
                                    <button class="btn btn-square btn-sm btn-outline" onclick="viewInvoice(1)" title="View">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                        </svg>
                                    </button>
                                    <button class="btn btn-square btn-sm btn-outline" onclick="editInvoice(1)" title="Edit">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </button>
                                    <div class="dropdown dropdown-end">
                                        <button tabindex="0" class="btn btn-square btn-sm btn-outline">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                            </svg>
                                        </button>
                                        <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-white rounded-box w-52 border">
                                            <li><a onclick="recordPayment(1)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                                </svg>
                                                Record Payment
                                            </a></li>
                                            <li><a onclick="duplicateInvoice(1)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                </svg>
                                                Duplicate
                                            </a></li>
                                            <li><a onclick="downloadInvoice(1)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                Download PDF
                                            </a></li>
                                            <li><a onclick="sendInvoice(1)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                                </svg>
                                                Send to Client
                                            </a></li>
                                            <li><a onclick="sendReminder(1)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                Send Reminder
                                            </a></li>
                                            <li class="divider"></li>
                                            <li><a onclick="cancelInvoice(1)" class="text-red-600">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                                </svg>
                                                Cancel Invoice
                                            </a></li>
                                            <li><a onclick="deleteInvoice(1)" class="text-red-600">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Partially Paid Invoice -->
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="p-4">
                                <div class="font-medium text-gray-900">INV-2025-09-002</div>
                                <div class="text-sm text-gray-500">Created yesterday</div>
                            </td>
                            <td class="p-4">
                                <div class="font-medium text-gray-900">TechStart Inc</div>
                                <div class="text-sm text-gray-500">sarah@techstart.io</div>
                            </td>
                            <td class="p-4">
                                <div class="text-gray-900">Sep 13, 2025</div>
                                <div class="text-sm text-gray-500">1 day ago</div>
                            </td>
                            <td class="p-4">
                                <div class="text-gray-900">Oct 13, 2025</div>
                                <div class="text-sm text-orange-600">29 days</div>
                            </td>
                            <td class="p-4 text-right">
                                <div class="font-medium text-gray-900">$5,200.00</div>
                                <div class="text-sm text-gray-500">USD</div>
                            </td>
                            <td class="p-4 text-center">
                                <div class="flex flex-col items-center gap-1">
                                    <span class="badge badge-warning badge-sm">Partial</span>
                                    <div class="text-xs text-gray-500">$2,600 paid</div>
                                </div>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge badge-info badge-sm">Sent</span>
                            </td>
                            <td class="p-4">
                                <div class="flex items-center justify-center gap-2">
                                    <button class="btn btn-square btn-sm btn-outline" onclick="viewInvoice(2)" title="View">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                        </svg>
                                    </button>
                                    <button class="btn btn-square btn-sm btn-outline" onclick="recordPayment(2)" title="Record Payment">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                        </svg>
                                    </button>
                                    <div class="dropdown dropdown-end">
                                        <button tabindex="0" class="btn btn-square btn-sm btn-outline">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                            </svg>
                                        </button>
                                        <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-white rounded-box w-52 border">
                                            <li><a onclick="editInvoice(2)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </a></li>
                                            <li><a onclick="sendReminder(2)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                Send Reminder
                                            </a></li>
                                            <li><a onclick="downloadInvoice(2)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                Download PDF
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Overdue Invoice -->
                        <tr class="border-b border-gray-100 hover:bg-gray-50 bg-red-50">
                            <td class="p-4">
                                <div class="font-medium text-gray-900">INV-2025-08-015</div>
                                <div class="text-sm text-gray-500">Overdue</div>
                            </td>
                            <td class="p-4">
                                <div class="font-medium text-gray-900">Global Solutions Ltd</div>
                                <div class="text-sm text-gray-500">mike@globalsolutions.com</div>
                            </td>
                            <td class="p-4">
                                <div class="text-gray-900">Aug 15, 2025</div>
                                <div class="text-sm text-gray-500">30 days ago</div>
                            </td>
                            <td class="p-4">
                                <div class="text-red-600 font-medium">Sep 14, 2025</div>
                                <div class="text-sm text-red-600">Overdue</div>
                            </td>
                            <td class="p-4 text-right">
                                <div class="font-medium text-gray-900">$1,250.00</div>
                                <div class="text-sm text-gray-500">USD</div>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge badge-error badge-sm">Overdue</span>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge badge-info badge-sm">Sent</span>
                            </td>
                            <td class="p-4">
                                <div class="flex items-center justify-center gap-2">
                                    <button class="btn btn-square btn-sm btn-outline" onclick="viewInvoice(3)" title="View">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                        </svg>
                                    </button>
                                    <button class="btn btn-square btn-sm bg-red-100 text-red-600 hover:bg-red-200" onclick="sendReminder(3)" title="Send Reminder">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </button>
                                    <div class="dropdown dropdown-end">
                                        <button tabindex="0" class="btn btn-square btn-sm btn-outline">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                            </svg>
                                        </button>
                                        <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-white rounded-box w-52 border">
                                            <li><a onclick="recordPayment(3)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                                </svg>
                                                Record Payment
                                            </a></li>
                                            <li><a onclick="editInvoice(3)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </a></li>
                                            <li><a onclick="downloadInvoice(3)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                Download PDF
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Draft Invoice -->
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="p-4">
                                <div class="font-medium text-gray-900">INV-2025-09-003</div>
                                <div class="text-sm text-gray-500">Draft</div>
                            </td>
                            <td class="p-4">
                                <div class="font-medium text-gray-900">Startup Ventures</div>
                                <div class="text-sm text-gray-500">alex@startupventures.com</div>
                            </td>
                            <td class="p-4">
                                <div class="text-gray-900">Sep 12, 2025</div>
                                <div class="text-sm text-gray-500">2 days ago</div>
                            </td>
                            <td class="p-4">
                                <div class="text-gray-900">Oct 12, 2025</div>
                                <div class="text-sm text-gray-500">Not sent</div>
                            </td>
                            <td class="p-4 text-right">
                                <div class="font-medium text-gray-900">$3,400.00</div>
                                <div class="text-sm text-gray-500">USD</div>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge badge-outline badge-sm">Unpaid</span>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge badge-outline badge-sm">Draft</span>
                            </td>
                            <td class="p-4">
                                <div class="flex items-center justify-center gap-2">
                                    <button class="btn btn-square btn-sm btn-outline" onclick="editInvoice(4)" title="Edit">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </button>
                                    <button class="btn btn-square btn-sm btn-outline" onclick="sendInvoice(4)" title="Send">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                        </svg>
                                    </button>
                                    <div class="dropdown dropdown-end">
                                        <button tabindex="0" class="btn btn-square btn-sm btn-outline">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                            </svg>
                                        </button>
                                        <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-white rounded-box w-52 border">
                                            <li><a onclick="duplicateInvoice(4)">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                </svg>
                                                Duplicate
                                            </a></li>
                                            <li><a onclick="deleteInvoice(4)" class="text-red-600">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="p-6 border-t border-gray-200">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                    <div class="text-sm text-gray-600">
                        Showing <span class="font-medium">1</span> to <span class="font-medium">4</span> 
                        of <span class="font-medium">4</span> invoices
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="btn btn-outline btn-sm" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                            Previous
                        </button>
                        <span class="btn btn-sm bg-main text-white">1</span>
                        <button class="btn btn-outline btn-sm" disabled>
                            Next
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Search and Filter functionality
let invoicesData = []; // This would be populated with actual data from Django
let filteredData = [];
let currentSort = { field: '', direction: 'asc' };

// Initialize search functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add search input event listener
    document.getElementById('searchInput').addEventListener('input', performSearch);
    
    // Add Enter key support for search
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });
});

function performSearch() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const paymentStatusFilter = document.getElementById('paymentStatusFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;
    const dateFilter = document.getElementById('dateFilter').value;
    const amountFilter = document.getElementById('amountFilter').value;
    
    // Apply all filters together
    applyFilters();
}

function applyFilters() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const paymentStatusFilter = document.getElementById('paymentStatusFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;
    const dateFilter = document.getElementById('dateFilter').value;
    const amountFilter = document.getElementById('amountFilter').value;
    
    // In a real implementation, this would filter the actual data
    // For now, we'll just update the UI to show filtering is working
    
    console.log('Applying filters:', {
        search: searchTerm,
        paymentStatus: paymentStatusFilter,
        status: statusFilter,
        date: dateFilter,
        amount: amountFilter
    });
    
    // Here you would make an AJAX call to filter the data
    // updateTable(filteredData);
}

function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('paymentStatusFilter').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('dateFilter').value = '';
    document.getElementById('amountFilter').value = '';
    applyFilters();
}

function sortTable(field) {
    // Toggle sort direction
    if (currentSort.field === field) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
    } else {
        currentSort.field = field;
        currentSort.direction = 'asc';
    }
    
    console.log('Sorting by:', field, currentSort.direction);
    // Here you would sort the data and update the table
}

function changeEntriesPerPage() {
    const entries = document.getElementById('entriesPerPage').value;
    console.log('Changing entries per page to:', entries);
    // Here you would update the pagination and reload data
}

// Invoice actions
function viewInvoice(id) {
    console.log('Viewing invoice:', id);
    // Redirect to invoice view page or open modal
}

function editInvoice(id) {
    console.log('Editing invoice:', id);
    window.location.href = `{% url 'billingapp:invoice' %}?edit=${id}`;
}

function recordPayment(id) {
    console.log('Recording payment for invoice:', id);
    // Open payment recording modal or redirect to payment page
    const amount = prompt('Enter payment amount:');
    if (amount && !isNaN(amount)) {
        alert(`Payment of $${amount} recorded for invoice ${id}`);
        // Make AJAX call to record payment
    }
}

function duplicateInvoice(id) {
    console.log('Duplicating invoice:', id);
    if (confirm('Create a copy of this invoice?')) {
        // Make AJAX call to duplicate invoice
        alert('Invoice duplicated successfully!');
    }
}

function downloadInvoice(id) {
    console.log('Downloading invoice:', id);
    // Generate and download PDF
    alert('PDF download started...');
}

function sendInvoice(id) {
    console.log('Sending invoice:', id);
    if (confirm('Send this invoice to the client?')) {
        // Make AJAX call to send invoice
        alert('Invoice sent successfully!');
    }
}

function sendReminder(id) {
    console.log('Sending reminder for invoice:', id);
    if (confirm('Send a payment reminder to the client?')) {
        // Make AJAX call to send reminder
        alert('Reminder sent successfully!');
    }
}

function cancelInvoice(id) {
    console.log('Cancelling invoice:', id);
    if (confirm('Are you sure you want to cancel this invoice? This action cannot be undone.')) {
        // Make AJAX call to cancel invoice
        alert('Invoice cancelled successfully!');
    }
}

function deleteInvoice(id) {
    console.log('Deleting invoice:', id);
    if (confirm('Are you sure you want to delete this invoice? This action cannot be undone.')) {
        // Make AJAX call to delete invoice
        alert('Invoice deleted successfully!');
        // Remove row from table or reload data
    }
}

function exportInvoices() {
    console.log('Exporting invoices');
    // Export filtered data to CSV/Excel
    alert('Export started...');
}
</script>

<style>
.input:focus, .select:focus {
    box-shadow: 0 0 0 3px rgba(81, 41, 206, 0.1);
}

.table tbody tr:hover {
    background-color: #f9fafb;
}

.dropdown:hover .dropdown-content {
    display: block;
}

.badge-info {
    background-color: #3b82f6;
    color: white;
}

.badge-success {
    background-color: #10b981;
    color: white;
}

.badge-warning {
    background-color: #f59e0b;
    color: white;
}

.badge-error {
    background-color: #ef4444;
    color: white;
}

.badge-outline {
    border: 1px solid #d1d5db;
    background-color: transparent;
    color: #6b7280;
}

.bg-red-50 {
    background-color: #fef2f2;
}
</style>
{% endblock %}